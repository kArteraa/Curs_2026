# Тестирование

## Установка зависимостей

```bash
npm install
```

## Запуск тестов

```bash
# Запуск всех тестов
npm test

# Запуск в режиме наблюдения
npm run test:watch

# Запуск с покрытием кода
npm run test:coverage
```

## Структура тестов

### 1. Интеграционные тесты вычислений (`src/__tests__/calculations.test.ts`)

Проверяют вычисления на реальной базе данных:

- **Тест 1**: Вычисление средней цены для набора путевок с разными ценами
- **Тест 2**: Вычисление средней цены с учетом только путевок указанного типа (изоляция по типу направления)
- **Тест 3**: Вычисление средней цены для большого количества путевок (20 путевок)

### 2. Тесты репозитория (`src/repositories/__tests__/TourPackageRepository.test.ts`)

Проверяют вычисления на уровне репозитория:

- Вычисление средней цены для нескольких путевок
- Вычисление средней цены для одной путевки
- Возврат 0 для пустого списка путевок
- Вычисление средней цены с дробными значениями

### 3. Тесты сервиса (`src/services/__tests__/TourPackageService.test.ts`)

Проверяют валидацию и вычисления на уровне сервиса:

- Правильное вычисление средней цены через репозиторий
- Валидация невалидных ID типа направления
- Валидация цены, длительности и destinationTypeId при создании

## Требования

- PostgreSQL должен быть запущен и доступен
- База данных должна быть настроена (переменные окружения в `.env`)
- Миграции должны быть выполнены (`npm run migrate`)

## Примечания

- Тесты используют реальную базу данных, поэтому создают и удаляют тестовые данные
- Каждый тест очищает данные перед выполнением
- После всех тестов выполняется очистка тестовых данных
